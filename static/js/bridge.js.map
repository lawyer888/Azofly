{
  "version": 3,
  "sources": ["../../node_modules/uuid/dist/esm-browser/rng.js", "../../node_modules/uuid/dist/esm-browser/stringify.js", "../../node_modules/uuid/dist/esm-browser/native.js", "../../node_modules/uuid/dist/esm-browser/v4.js", "../../packages/core/js/src/bridge.js"],
  "sourcesContent": ["// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nlet getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}", "import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nconst byteToHex = [];\n\nfor (let i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).slice(1));\n}\n\nexport function unsafeStringify(arr, offset = 0) {\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  return byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]];\n}\n\nfunction stringify(arr, offset = 0) {\n  const uuid = unsafeStringify(arr, offset); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;", "const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default {\n  randomUUID\n};", "import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  if (native.randomUUID && !buf && !options) {\n    return native.randomUUID();\n  }\n\n  options = options || {};\n  const rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (let i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return unsafeStringify(rnds);\n}\n\nexport default v4;", "// azofly/packages/core/js/src/bridge.js\r\n\r\n/**\r\n * bridge.js\r\n * \u63D0\u4F9B JavaScript \u548C Go \u4E4B\u95F4\u7684\u901A\u4FE1\u5C42\r\n */\r\n\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nclass GoBridge {\r\n\tconstructor(kafkaConfig) {\r\n\t\tthis.kafkaConfig = kafkaConfig || {\r\n\t\t\tbrokers: ['localhost:9092'],\r\n\t\t\tclientId: 'azofly-client',\r\n\t\t};\r\n\r\n\t\tthis.pendingRequests = new Map();\r\n\t\tthis.responseHandlers = new Map();\r\n\r\n\t\t// \u521D\u59CB\u5316 Kafka \u5BA2\u6237\u7AEF\r\n\t\tthis.initKafkaClient();\r\n\r\n\t\t// \u5F00\u59CB\u76D1\u542C\u54CD\u5E94\r\n\t\tthis.startResponseListener();\r\n\t}\r\n\r\n\t/**\r\n\t * \u521D\u59CB\u5316 Kafka \u5BA2\u6237\u7AEF\r\n\t * \u6CE8\u610F\uFF1A\u8FD9\u662F\u4E00\u4E2A\u7B80\u5316\u7684\u5B9E\u73B0\uFF0C\u5B9E\u9645\u5E94\u7528\u4E2D\u4F1A\u4F7F\u7528\u771F\u6B63\u7684 Kafka \u5BA2\u6237\u7AEF\u5E93\r\n\t */\r\n\tinitKafkaClient() {\r\n\t\t// \u5728\u5B9E\u9645\u5B9E\u73B0\u4E2D\uFF0C\u8FD9\u91CC\u4F1A\u521D\u59CB\u5316 Kafka \u5BA2\u6237\u7AEF\r\n\t\t// \u4E3A\u4E86\u7B80\u5316\uFF0C\u6211\u4EEC\u4F7F\u7528\u6A21\u62DF\u5B9E\u73B0\r\n\t\tthis.kafkaClient = {\r\n\t\t\tsendMessage: async (topic, key, value) => {\r\n\t\t\t\tconsole.log(`[Kafka] \u53D1\u9001\u6D88\u606F\u5230\u4E3B\u9898 ${topic}\uFF0C\u952E: ${key}`);\r\n\r\n\t\t\t\t// \u6A21\u62DF\u7F51\u7EDC\u5EF6\u8FDF\r\n\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, 100));\r\n\r\n\t\t\t\t// \u5728\u5B9E\u9645\u5B9E\u73B0\u4E2D\uFF0C\u8FD9\u91CC\u4F1A\u53D1\u9001\u6D88\u606F\u5230 Kafka\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\r\n\t\t\tconsumeMessages: (topic, handler) => {\r\n\t\t\t\tconsole.log(`[Kafka] \u5F00\u59CB\u4ECE\u4E3B\u9898 ${topic} \u6D88\u8D39\u6D88\u606F`);\r\n\r\n\t\t\t\t// \u5728\u5B9E\u9645\u5B9E\u73B0\u4E2D\uFF0C\u8FD9\u91CC\u4F1A\u4ECE Kafka \u6D88\u8D39\u6D88\u606F\r\n\t\t\t\t// \u4E3A\u4E86\u7B80\u5316\uFF0C\u6211\u4EEC\u4E0D\u505A\u4EFB\u4F55\u4E8B\u60C5\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * \u53D1\u9001\u8BF7\u6C42\u5230 Go \u540E\u7AEF\r\n\t * @param {string} path - API \u8DEF\u5F84\r\n\t * @param {object} options - \u8BF7\u6C42\u9009\u9879\r\n\t * @returns {Promise<any>} - Go \u7684\u54CD\u5E94\r\n\t */\r\n\tasync sendRequest(path, options = {}) {\r\n\t\tconst requestId = uuidv4();\r\n\r\n\t\tconst request = {\r\n\t\t\tid: requestId,\r\n\t\t\tpath,\r\n\t\t\tmethod: options.method || 'GET',\r\n\t\t\theaders: options.headers || {},\r\n\t\t\tbody: options.body ? JSON.stringify(options.body) : null,\r\n\t\t\ttimestamp: Date.now(),\r\n\t\t};\r\n\r\n\t\t// \u521B\u5EFA\u4E00\u4E2A\u5728\u6536\u5230\u54CD\u5E94\u65F6\u4F1A\u88AB\u89E3\u51B3\u7684 Promise\r\n\t\tconst responsePromise = new Promise((resolve, reject) => {\r\n\t\t\t// \u5B58\u50A8 resolve/reject \u51FD\u6570\uFF0C\u5728\u54CD\u5E94\u5230\u8FBE\u65F6\u8C03\u7528\r\n\t\t\tthis.pendingRequests.set(requestId, { resolve, reject });\r\n\r\n\t\t\t// \u8BBE\u7F6E\u8D85\u65F6\uFF0C\u5982\u679C\u6CA1\u6709\u6536\u5230\u54CD\u5E94\u5219\u62D2\u7EDD Promise\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (this.pendingRequests.has(requestId)) {\r\n\t\t\t\t\tconst { reject } = this.pendingRequests.get(requestId);\r\n\t\t\t\t\treject(new Error('\u8BF7\u6C42\u8D85\u65F6'));\r\n\t\t\t\t\tthis.pendingRequests.delete(requestId);\r\n\t\t\t\t}\r\n\t\t\t}, options.timeout || 30000); // \u9ED8\u8BA4 30 \u79D2\u8D85\u65F6\r\n\t\t});\r\n\r\n\t\t// \u53D1\u9001\u8BF7\u6C42\u5230 Kafka\r\n\t\tawait this.kafkaClient.sendMessage(\r\n\t\t\t'azofly-ssr-requests',\r\n\t\t\trequestId,\r\n\t\t\tJSON.stringify(request),\r\n\t\t);\r\n\r\n\t\treturn responsePromise;\r\n\t}\r\n\r\n\t/**\r\n\t * \u6CE8\u518C\u7279\u5B9A\u54CD\u5E94\u7C7B\u578B\u7684\u5904\u7406\u5668\r\n\t * @param {string} type - \u54CD\u5E94\u7C7B\u578B\r\n\t * @param {Function} handler - \u5904\u7406\u51FD\u6570\r\n\t */\r\n\tregisterResponseHandler(type, handler) {\r\n\t\tthis.responseHandlers.set(type, handler);\r\n\t}\r\n\r\n\t/**\r\n\t * \u5F00\u59CB\u76D1\u542C\u6765\u81EA Go \u540E\u7AEF\u7684\u54CD\u5E94\r\n\t */\r\n\tstartResponseListener() {\r\n\t\tthis.kafkaClient.consumeMessages('azofly-ssr-responses', (message) => {\r\n\t\t\ttry {\r\n\t\t\t\tconst response = JSON.parse(message);\r\n\r\n\t\t\t\t// \u5982\u679C\u8FD9\u662F\u5BF9\u5F85\u5904\u7406\u8BF7\u6C42\u7684\u54CD\u5E94\uFF0C\u89E3\u51B3 Promise\r\n\t\t\t\tif (\r\n\t\t\t\t\tresponse.requestId &&\r\n\t\t\t\t\tthis.pendingRequests.has(response.requestId)\r\n\t\t\t\t) {\r\n\t\t\t\t\tconst { resolve, reject } = this.pendingRequests.get(\r\n\t\t\t\t\t\tresponse.requestId,\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\tif (response.error) {\r\n\t\t\t\t\t\treject(new Error(response.error));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tresolve(response);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.pendingRequests.delete(response.requestId);\r\n\t\t\t\t}\r\n\t\t\t\t// \u5426\u5219\uFF0C\u7528\u6CE8\u518C\u7684\u54CD\u5E94\u5904\u7406\u5668\u5904\u7406\r\n\t\t\t\telse if (response.type && this.responseHandlers.has(response.type)) {\r\n\t\t\t\t\tconst handler = this.responseHandlers.get(response.type);\r\n\t\t\t\t\thandler(response);\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('\u5904\u7406\u54CD\u5E94\u9519\u8BEF:', err);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default GoBridge;\r\n"],
  "mappings": "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",
  "names": ["getRandomValues", "rnds8", "rng", "byteToHex", "i", "unsafeStringify", "arr", "offset", "randomUUID", "native_default", "v4", "options", "buf", "offset", "native_default", "rnds", "rng", "i", "unsafeStringify", "v4_default", "GoBridge", "kafkaConfig", "topic", "key", "value", "resolve", "handler", "path", "options", "requestId", "v4_default", "request", "responsePromise", "reject", "type", "message", "response", "err", "bridge_default"]
}
